import{r as c,y as C,z as f,a as i,o as u,b as t,d as w,w as x,f as U,i as y,B as S,k as D,t as n,h as F,F as N,e as V,g as $,n as B}from"./app-CmJRaKAb.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"exchanges-page"},E={class:"page-header"},M={class:"filters-card"},L={class:"filters"},P={class:"filter-group"},R={class:"filter-group"},T={key:0,class:"loading"},Z={key:1,class:"alert alert-error"},j={key:2,class:"empty-state"},q={key:3,class:"table-card"},A={class:"data-table"},G={class:"text-small"},H={class:"font-weight-bold"},J={class:"action-buttons"},K=["onClick"],O={key:0,class:"pagination"},Q=["disabled"],W={class:"pagination-info"},X=["disabled"],Y={__name:"Index",setup(tt){const v=c([]),o=c(null),_=c(!1),p=c(null),s=c({type:"",date:"",page:1});C(()=>{r()});async function r(){var d,e;_.value=!0,p.value=null;try{const l=new URLSearchParams;s.value.type&&l.append("type",s.value.type),s.value.date&&l.append("date",s.value.date),l.append("page",s.value.page);const a=await f.get(`/exchanges?${l}`);a.data.success&&(v.value=a.data.data.data||a.data.data,o.value=a.data.data.meta)}catch(l){p.value=((e=(d=l.response)==null?void 0:d.data)==null?void 0:e.message)||"Ошибка загрузки обменов"}finally{_.value=!1}}function h(){s.value={type:"",date:"",page:1},r()}function g(d){s.value.page=d,r()}async function k(d){var e,l;if(confirm("Удалить обмен валюты?"))try{await f.delete(`/exchanges/${d}`),await r()}catch(a){alert(((l=(e=a.response)==null?void 0:e.data)==null?void 0:l.message)||"Ошибка удаления обмена")}}function m(d){return new Intl.NumberFormat("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).format(d)}return(d,e)=>{const l=U("router-link");return u(),i("div",z,[t("div",E,[e[5]||(e[5]=t("h1",{class:"page-title"},"Обмен валют",-1)),w(l,{to:"/exchanges/create",class:"btn btn-primary"},{default:x(()=>[...e[4]||(e[4]=[$(" + Новый обмен ",-1)])]),_:1})]),t("div",M,[t("div",L,[t("div",P,[e[7]||(e[7]=t("label",null,"Тип операции",-1)),y(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.type=a),onChange:r,class:"form-select"},[...e[6]||(e[6]=[t("option",{value:""},"Все",-1),t("option",{value:"buy"},"Покупка",-1),t("option",{value:"sell"},"Продажа",-1)])],544),[[S,s.value.type]])]),t("div",R,[e[8]||(e[8]=t("label",null,"Дата",-1)),y(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>s.value.date=a),onChange:r,class:"form-input"},null,544),[[D,s.value.date]])]),t("button",{onClick:h,class:"btn btn-secondary"},"Очистить")])]),_.value?(u(),i("div",T,"Загрузка...")):p.value?(u(),i("div",Z,n(p.value),1)):v.value.length===0?(u(),i("div",j,[...e[9]||(e[9]=[t("p",null,"Обмены валют не найдены",-1)])])):(u(),i("div",q,[t("table",A,[e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",null,"Дата/Время"),t("th",null,"Тип операции"),t("th",null,"Сумма USD"),t("th",null,"Курс"),t("th",null,"Сумма UZS"),t("th",null,"Кассир"),t("th",null,"Действия")])],-1)),t("tbody",null,[(u(!0),i(N,null,V(v.value,a=>{var b;return u(),i("tr",{key:a.id},[t("td",null,[t("div",null,n(a.date),1),t("div",G,n(a.time),1)]),t("td",null,[t("span",{class:B(["badge",a.type==="buy"?"badge-success":"badge-info"])},n(a.type==="buy"?"Покупка":"Продажа"),3)]),t("td",H,n(m(a.usd_amount))+" USD",1),t("td",null,n(m(a.rate)),1),t("td",null,n(m(a.uzs_amount))+" UZS",1),t("td",null,n((b=a.cashier)==null?void 0:b.full_name),1),t("td",null,[t("div",J,[t("button",{onClick:et=>k(a.id),class:"btn-action btn-danger",title:"Удалить"}," × ",8,K)])])])}),128))])]),o.value?(u(),i("div",O,[t("button",{onClick:e[2]||(e[2]=a=>g(o.value.current_page-1)),disabled:o.value.current_page===1,class:"btn btn-secondary"}," Назад ",8,Q),t("span",W," Страница "+n(o.value.current_page)+" из "+n(o.value.last_page),1),t("button",{onClick:e[3]||(e[3]=a=>g(o.value.current_page+1)),disabled:o.value.current_page===o.value.last_page,class:"btn btn-secondary"}," Вперед ",8,X)])):F("",!0)]))])}}},lt=I(Y,[["__scopeId","data-v-1e6e3926"]]);export{lt as default};
